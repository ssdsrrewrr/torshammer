name: Tor's Hammer DoS Test

on:
  push:
    branches: [ main ]
  workflow_dispatch:  # Allows manual trigger from GitHub UI

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'

    - name: Install dependencies
      run: |
        pip install pysocks requests
        sudo apt-get update
        sudo apt-get install -y tor

    - name: Start Tor (for anonymity)
      run: |
        sudo service tor start
        sleep 5  # Wait for Tor to initialize

    - name: Run Tor's Hammer
      run: |
        # IMPORTANT: Replace with YOUR OWN test target (e.g., localhost or a dev server you control)
        # Example for local test (start a server in the VM):
        python3 -m http.server 8000 --bind 127.0.0.1 &
        sleep 2  # Give server time to start
        python3 torshammer.py -s 127.0.0.1 -p 8000 -r 100  # No -T for simplicity in VM
        # For external: python3 torshammer.py -s ${{ secrets.TEST_TARGET }} -p 80 -r 200 -T
      env:
        TARGET: ${{ secrets.TEST_TARGET }}  # Optional: Set in Repo Settings > Secrets

    - name: Upload logs as artifact (if generated)
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: dos-logs
        path: |
          *.log
          torshammer*.out  # Adjust based on tool's output files
        retention-days: 1  # Keep short for temp tests
